<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Farmer Dashboard - AgriSustain</title>
    <link rel="stylesheet" href="dashboard.css">
    <link rel="stylesheet" href="expert-chat.css">
</head>

<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-header">
            <h2>ğŸŒ¾ AgriSustain</h2>
        </div>
        <div class="sidebar-menu">
            <a href="#" class="menu-item active">
                <span class="icon">ğŸ“Š</span>
                <span>Dashboard</span>
            </a>
            <a href="#" class="menu-item">
                <span class="icon">ğŸŒ±</span>
                <span>My Crops</span>
            </a>
            <a href="marketplace.html" class="menu-item">
                <span class="icon">ğŸª</span>
                <span>Marketplace</span>
            </a>
            <a href="#" class="menu-item">
                <span class="icon">ğŸŒ¦ï¸</span>
                <span>Weather</span>
            </a>
            <a href="#" class="menu-item">
                <span class="icon">ğŸ”¬</span>
                <span>Soil Health</span>
            </a>
        </div>
        <div class="sidebar-footer">
            <button class="logout-btn" onclick="logout()">Logout</button>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <div class="header-bar">
            <div class="user-welcome">
                <h1>Welcome, <span id="userNameDisplay">Farmer</span>!</h1>
                <p>Here's what's happening on your farm today.</p>
            </div>
            <div class="header-actions">
                <p id="currentDate"></p>
            </div>
        </div>

        <!-- Stats Grid -->
        <div class="dashboard-grid">
            <div class="stat-card">
                <div class="stat-icon">ğŸŒ¾</div>
                <div class="stat-info">
                    <h3>Active Crops</h3>
                    <p>4 Fields</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">ğŸ’°</div>
                <div class="stat-info">
                    <h3>Total Sales</h3>
                    <p>â‚¹45,200</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">â˜ï¸</div>
                <div class="stat-info">
                    <h3>Weather</h3>
                    <p>28Â°C, Clear</p>
                </div>
            </div>
        </div>

        <!-- Crop Management -->
        <div class="feature-section">
            <h2>ğŸŒ± Current Crops Status</h2>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Crop Name</th>
                        <th>Field Area</th>
                        <th>Sowing Date</th>
                        <th>Status</th>
                        <th>Health</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Wheat (Kanak)</td>
                        <td>2.5 Acres</td>
                        <td>Nov 15, 2025</td>
                        <td><span class="status-badge status-active">Growing</span></td>
                        <td>Good (88%)</td>
                    </tr>
                    <tr>
                        <td>Mustard</td>
                        <td>1.0 Acre</td>
                        <td>Dec 02, 2025</td>
                        <td><span class="status-badge status-active">Early Stage</span></td>
                        <td>Excellent (95%)</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Market Trends -->
        <div class="feature-section">
            <h2>ğŸ“ˆ Marketplace Trends</h2>
            <div class="dashboard-grid">
                <div style="background:#f8f9fa; padding:15px; border-radius:10px;">
                    <h4>Rice (Premium)</h4>
                    <p style="color:green; font-weight:bold;">â‚¹2,400/quintal (+2%)</p>
                </div>
                <div style="background:#f8f9fa; padding:15px; border-radius:10px;">
                    <h4>Wheat</h4>
                    <p style="color:red; font-weight:bold;">â‚¹2,125/quintal (-1%)</p>
                </div>
                <div style="background:#f8f9fa; padding:15px; border-radius:10px;">
                    <h4>Cotton</h4>
                    <p style="color:green; font-weight:bold;">â‚¹6,800/quintal (+5%)</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Expert Chat Widget -->
    <div class="expert-chat-widget" id="expertChatWidget">
        <!-- Floating Chat Button -->
        <button class="chat-float-btn" id="chatFloatBtn" onclick="toggleExpertChat()">
            <span class="chat-icon">ğŸ‘¨â€ğŸŒ¾</span>
            <span class="chat-pulse"></span>
            <span class="chat-text">Chat with Experts</span>
        </button>

        <!-- Expert Selection Panel -->
        <div class="expert-panel" id="expertPanel" style="display: none;">
            <div class="expert-panel-header">
                <h3>ğŸŒ¾ AgriSustain Experts</h3>
                <button class="close-panel-btn" onclick="closeExpertPanel()">Ã—</button>
            </div>
            <p class="expert-panel-subtitle">Connect with verified agricultural experts</p>

            <div class="experts-list">
                <div class="expert-item" onclick="startChat('dr_sharma')">
                    <div class="expert-avatar">
                        <span class="avatar-img">ğŸ‘¨â€ğŸŒ¾</span>
                        <span class="status-online"></span>
                    </div>
                    <div class="expert-info">
                        <h4>Dr. Rajesh Sharma</h4>
                        <p class="expert-specialty">ğŸ“ Organic Farming Specialist</p>
                        <p class="expert-exp">15+ years experience</p>
                        <div class="expert-rating">â­â­â­â­â­ <span>(450 consultations)</span></div>
                    </div>
                    <button class="chat-btn">Chat Now</button>
                </div>

                <div class="expert-item" onclick="startChat('dr_patel')">
                    <div class="expert-avatar">
                        <span class="avatar-img">ğŸ‘©â€ğŸŒ¾</span>
                        <span class="status-online"></span>
                    </div>
                    <div class="expert-info">
                        <h4>Dr. Priya Patel</h4>
                        <p class="expert-specialty">ğŸŒ± Soil Science Expert</p>
                        <p class="expert-exp">12+ years experience</p>
                        <div class="expert-rating">â­â­â­â­â­ <span>(380 consultations)</span></div>
                    </div>
                    <button class="chat-btn">Chat Now</button>
                </div>

                <div class="expert-item" onclick="startChat('prof_kumar')">
                    <div class="expert-avatar">
                        <span class="avatar-img">ğŸ‘¨â€ğŸ”¬</span>
                        <span class="status-online"></span>
                    </div>
                    <div class="expert-info">
                        <h4>Prof. Amit Kumar</h4>
                        <p class="expert-specialty">ğŸŒ¾ Crop Management</p>
                        <p class="expert-exp">20+ years experience</p>
                        <div class="expert-rating">â­â­â­â­â­ <span>(520 consultations)</span></div>
                    </div>
                    <button class="chat-btn">Chat Now</button>
                </div>

                <div class="expert-item" onclick="startChat('dr_singh')">
                    <div class="expert-avatar">
                        <span class="avatar-img">ğŸ‘¨â€âš•ï¸</span>
                        <span class="status-online"></span>
                    </div>
                    <div class="expert-info">
                        <h4>Dr. Vikram Singh</h4>
                        <p class="expert-specialty">ğŸ› Pest Control Specialist</p>
                        <p class="expert-exp">10+ years experience</p>
                        <div class="expert-rating">â­â­â­â­â­ <span>(290 consultations)</span></div>
                    </div>
                    <button class="chat-btn">Chat Now</button>
                </div>
            </div>
        </div>

        <!-- Chat Window -->
        <div class="chat-window" id="chatWindow" style="display: none;">
            <div class="chat-header">
                <div class="chat-header-info">
                    <div class="expert-avatar-small">
                        <span id="chatExpertAvatar">ğŸ‘¨â€ğŸŒ¾</span>
                        <span class="status-online-small"></span>
                    </div>
                    <div>
                        <h4 id="chatExpertName">Expert Name</h4>
                        <p id="chatExpertStatus">Online</p>
                    </div>
                </div>
                <div class="chat-header-actions">
                    <button class="chat-action-btn" onclick="minimizeChat()">âˆ’</button>
                    <button class="chat-action-btn" onclick="closeChat()">Ã—</button>
                </div>
            </div>

            <div class="chat-messages" id="chatMessages">
                <!-- Messages will be added here dynamically -->
            </div>

            <div class="chat-input-container">
                <input type="text" id="chatInput" class="chat-input" placeholder="Type your question..."
                    onkeypress="handleChatKeyPress(event)">
                <button class="send-btn" onclick="sendMessage()">
                    <span>â¤</span>
                </button>
            </div>
        </div>
    </div>

    <script src="auth.js"></script>
    <script>
        // Protect page and initialize user data
        const session = protectPage('farmer');
        if (session) {
            document.getElementById('userNameDisplay').textContent = session.name;
            document.getElementById('currentDate').textContent = new Date().toLocaleDateString('en-US', {
                weekday: 'long', year: 'numeric', month: 'long', day: 'numeric'
            });
        }

        // Initialize Expert Chat dynamically or load it
        // For this demo, we'll assume the script is included in index.html
    </script>
    <script src="expert-chat.js"></script>
</body>

</html>